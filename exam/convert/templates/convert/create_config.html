{% extends "base.html" %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'customize/css/create_config.css' %}">
{% endblock %}

{% block title %}
    创建模版
{% endblock title %}
{% block content %}
<form method="post" id="main-form">
    {% csrf_token %}
<!--    <input type="text" id="form_count" name="form_count" value="{{ grade_forms|length }}">-->
    <input type="hidden" id="form_count" name="form_count" value="{{ grade_forms|length }}">
    {{ config_form.as_p }}
    <table id="grade-table">
        <thead>
            <tr>
                <th>等级</th>
                <th>高分</th>
                <th>低分</th>
                <th>占比</th>
                <th></th>  <!-- Delete button column -->
            </tr>
        </thead>
        <tbody>
            {% for grade_form in grade_forms %}
                <tr class="grade-form">
                    <td>{{ grade_form.grade_name }}</td>
                    <td>{{ grade_form.high_score }}</td>
                    <td>{{ grade_form.low_score }}</td>
                    <td>{{ grade_form.percent }}</td>
                    <td><button type="button" class="delete-btn">删除</button></td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <button type="button" id="add-btn">添加</button>
    <button type="submit">保存</button>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const addBtn = document.getElementById('add-btn');
    const form = document.getElementById('main-form');

    // 添加按钮点击事件处理程序
    addBtn.addEventListener('click', function() {
        const gradeTable = document.getElementById('grade-table').getElementsByTagName('tbody')[0];
        const newRow = gradeTable.insertRow(-1); // Insert new row at the end of the table
        newRow.classList.add('grade-form');

        const fields = ['grade_name', 'high_score', 'low_score', 'percent'];
        const formIndex = document.querySelectorAll('.grade-form').length - 1; // 获取最后一个表单的索引
        fields.forEach(function(field) {
            const cell = newRow.insertCell();
            const input = document.createElement('input');
            input.name = formIndex + '-' + field;  // 使用正确的字段名称
            input.placeholder = field.charAt(0).toUpperCase() + field.slice(1); // Capitalize field name
            input.required = true; // Ensure the field is required
            cell.appendChild(input);
        });

        const deleteCell = newRow.insertCell();
        deleteCell.innerHTML = '<button type="button" class="delete-btn">删除</button>';

        // 为新添加的删除按钮添加点击事件处理程序
        const deleteBtn = deleteCell.querySelector('.delete-btn');
        deleteBtn.addEventListener('click', function() {
            newRow.remove(); // 移除当前行
            updateFormCount(); // 更新表单计数
        });

        updateFormCount(); // 更新表单计数
    });

    // 初始化时为每个删除按钮添加事件处理程序
    const deleteBtns = document.querySelectorAll('.delete-btn');
    deleteBtns.forEach(function(deleteBtn) {
        deleteBtn.addEventListener('click', function() {
            const row = deleteBtn.parentNode.parentNode;
            row.remove(); // 移除当前行
            updateFormCount(); // 更新表单计数
        });
    });

    // 更新表单计数函数
    function updateFormCount() {
        const gradeForms = document.querySelectorAll('.grade-form');
        document.getElementById('form_count').value = gradeForms.length;
    }
});

</script>



{% endblock content %}